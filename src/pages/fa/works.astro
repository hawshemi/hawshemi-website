---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Card from '../../components/Card.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects').catch(() => []);
const publications: { title: string; summary: string; link?: string; year?: number }[] = [];
---
<BaseLayout title="کارها — هاشمی">
  <Fragment slot="header"><Header /></Fragment>

  <section class="max-w-5xl mx-auto">
    <header class="mb-12">
      <p class="text-sm font-semibold uppercase tracking-[0.3em] text-text-secondary mb-4">پورتفوی فنی</p>
      <h1 class="text-4xl font-bold tracking-tight mb-4 pb-1 bg-clip-text text-transparent bg-linear-to-br from-white to-white/50">پروژه‌ها و انتشارات</h1>
      <p class="text-lg text-text-secondary max-w-2xl">
        این بخش ترکیبی از پروژه‌های زیرساختی، ابزارهای اتوماسیون و یادداشت‌های فنی است که نشان می‌دهد چگونه امنیت، عملیات و طراحی سیستم را کنار هم می‌گذارم.
      </p>
    </header>

    <div class="space-y-16">
      <section aria-labelledby="projects-heading-fa">
        <header class="flex items-baseline justify-between mb-8">
          <div>
            <p class="text-xs uppercase tracking-[0.4em] text-text-secondary mb-2">ساخت‌ها</p>
            <h2 id="projects-heading-fa" class="text-3xl font-semibold tracking-tight">پروژه‌ها</h2>
          </div>
          <span class="text-sm text-text-secondary">{projects.length} مورد ثبت‌شده</span>
        </header>

        {projects.length === 0 ? (
          <div class="glass-card p-8 text-center">
            <p class="text-text-secondary">به‌زودی پروژه‌های جدید اضافه می‌شود.</p>
          </div>
        ) : (
          <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {projects.map((p) => (
              <Card title={p.data.title} href={p.data.links?.repo ?? p.data.links?.demo}>
                <p class="mb-4">{p.data.summary}</p>
                {p.data.stack && (
                  <ul class="flex flex-wrap gap-2 text-xs">
                    {p.data.stack.map((s: string) => (
                      <li class="px-2.5 py-1 rounded-full bg-white/5 text-text-secondary border border-white/5">
                        {s}
                      </li>
                    ))}
                  </ul>
                )}
              </Card>
            ))}
          </div>
        )}
      </section>

      <section aria-labelledby="publications-heading-fa">
        <header class="flex items-baseline justify-between mb-8">
          <div>
            <p class="text-xs uppercase tracking-[0.4em] text-text-secondary mb-2">نوشته‌ها</p>
            <h2 id="publications-heading-fa" class="text-3xl font-semibold tracking-tight">انتشارات</h2>
          </div>
          <span class="text-sm text-text-secondary">
            {publications.length > 0 ? `${publications.length} مورد` : 'به‌زودی منتشر می‌شود'}
          </span>
        </header>

        {publications.length === 0 ? (
          <div class="glass-card p-8 text-center">
            <p class="text-text-secondary">در حال نگارش یادداشت‌ها و مطالعه‌های موردی هستم.</p>
          </div>
        ) : (
          <div class="space-y-4">
            {publications.map((pub) => (
              <article class="glass-card interactive p-6 flex flex-col gap-3">
                <div class="flex items-center justify-between gap-3">
                  <div>
                    <h3 class="text-xl font-semibold">{pub.title}</h3>
                    {pub.year && <p class="text-text-secondary text-sm">{pub.year}</p>}
                  </div>
                  {pub.link && (
                    <a
                      href={pub.link}
                      class="text-sm font-medium text-accent hover:text-accent/80"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      مطالعه
                    </a>
                  )}
                </div>
                <p class="text-text-secondary">{pub.summary}</p>
              </article>
            ))}
          </div>
        )}
      </section>
    </div>
  </section>

  <Fragment slot="footer"><Footer /></Fragment>
</BaseLayout>



